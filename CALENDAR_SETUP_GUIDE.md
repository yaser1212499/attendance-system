# راهنمای کامل تقویم - سیستم حضور و غیاب

## 🎨 طراحی یکپارچه با سیستم

صفحه تقویم کاملاً بازطراحی شده و با قالب Argon Dashboard یکپارچه شده است:

### ✨ ویژگی‌های طراحی:

- **قالب یکپارچه** با بقیه صفحات سیستم
- **کارت‌های تمیز** با طراحی Argon Dashboard
- **دکمه‌های استاندارد** با گرادیان‌های رنگی
- **فرم‌های زیبا** با استایل یکسان
- **مودال‌های هماهنگ** با طراحی سیستم
- **وضعیت‌نمای حرفه‌ای** با badge های رنگی

### 🎯 عملکرد بهبود یافته:

- **بارگذاری خودکار** رویدادها از دیتابیس
- **ذخیره‌سازی پایدار** رویدادهای سفارشی
- **ویرایش و حذف** آسان رویدادها
- **کشیدن و رها کردن** رویدادها
- **نمایش وضعیت** اتصال به سرور

## 📅 مدیریت تاریخ‌ها

### ✅ مشکل حل شده:

- **تقویم شمسی** برای نمایش (راحت‌تر برای کاربران ایرانی)
- **تاریخ میلادی** در فرم و دیتابیس (سازگار با سیستم)
- **تبدیل خودکار** تاریخ‌ها بین شمسی و میلادی
- **نمایش صحیح** رویدادها در تقویم

### 🔧 نحوه کار:

1. **نمایش تقویم**: با locale انگلیسی اما دکمه‌های فارسی
2. **انتخاب تاریخ**: تاریخ میلادی در فرم قرار می‌گیرد
3. **ذخیره در دیتابیس**: تاریخ میلادی ذخیره می‌شود
4. **نمایش رویدادها**: تاریخ‌ها به درستی نمایش داده می‌شوند

## 🗄️ راه‌اندازی دیتابیس

### مرحله 1: ایجاد جدول calendar_events

در phpMyAdmin، دیتابیس `attendance_system4` را باز کنید و این SQL را اجرا کنید:

```sql
CREATE TABLE IF NOT EXISTS `calendar_events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `description` text,
  `start_date` date NOT NULL,
  `start_time` time DEFAULT NULL,
  `end_date` date DEFAULT NULL,
  `end_time` time DEFAULT NULL,
  `all_day` tinyint(1) DEFAULT 1,
  `color` varchar(7) DEFAULT '#9c27b0',
  `type` varchar(50) DEFAULT 'custom',
  `created_by` varchar(255) NOT NULL,
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `created_by` (`created_by`),
  KEY `start_date` (`start_date`),
  CONSTRAINT `fk_calendar_events_user` FOREIGN KEY (`created_by`) REFERENCES `users` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### مرحله 2: بررسی اتصال

پس از ایجاد جدول، سرور را راه‌اندازی کنید:

```bash
node server.cjs
```

## 🚀 استفاده از تقویم

### افزودن رویداد جدید:

1. روی هر روز در تقویم کلیک کنید
2. فرم رویداد باز می‌شود
3. عنوان، تاریخ و سایر جزئیات را وارد کنید
4. روی "افزودن رویداد" کلیک کنید

### ویرایش رویداد:

1. روی رویداد سفارشی کلیک کنید
2. اطلاعات را تغییر دهید
3. روی "بروزرسانی رویداد" کلیک کنید

### حذف رویداد:

1. روی رویداد سفارشی کلیک کنید
2. روی دکمه "حذف" کلیک کنید
3. تأیید کنید

## 🎨 انواع رویدادها

| نوع رویداد       | رنگ       | توضیح             |
| ---------------- | --------- | ----------------- |
| تعطیلات          | 🟠 نارنجی | تعطیلات رسمی      |
| مرخصی‌ها         | 🟢 سبز    | درخواست‌های مرخصی |
| شیفت‌ها          | 🔵 آبی    | شیفت‌های کاری     |
| حضور و غیاب      | 🔴 قرمز   | ثبت‌های ورود/خروج |
| رویدادهای سفارشی | 🟣 بنفش   | قابل ویرایش و حذف |

## 🔧 API Endpoints

### دریافت رویدادها:

```
GET /api/calendar-events
```

### افزودن رویداد جدید:

```
POST /api/calendar-events
{
  "title": "عنوان رویداد",
  "description": "توضیحات",
  "start_date": "2024-01-15",
  "start_time": "10:00:00",
  "all_day": false,
  "color": "#9c27b0"
}
```

### ویرایش رویداد:

```
PUT /api/calendar-events/{id}
```

### حذف رویداد:

```
DELETE /api/calendar-events/{id}
```

## 🎯 ویژگی‌های کلیدی

### ✅ عملکرد:

- **دینامیک**: تمام رویدادها از دیتابیس بارگذاری می‌شوند
- **پایدار**: رویدادها پس از رفرش باقی می‌مانند
- **تعاملی**: امکان کشیدن و رها کردن رویدادها
- **سریع**: بارگذاری بهینه با نشانگر وضعیت

### 🎨 طراحی:

- **یکپارچه**: کاملاً هماهنگ با قالب Argon Dashboard
- **تمیز**: طراحی مینیمال و حرفه‌ای
- **فارسی**: پشتیبانی کامل از RTL و فونت فارسی
- **واکنش‌گرا**: سازگار با تمام دستگاه‌ها

### 🔒 امنیت:

- **اعتبارسنجی**: بررسی ورودی‌های کاربر
- **مدیریت خطا**: نمایش پیام‌های مناسب
- **Foreign Key**: ارتباط امن با جدول کاربران

## 🐛 عیب‌یابی

### مشکل: رویدادها پس از رفرش حذف می‌شوند

**راه‌حل**: مطمئن شوید که:

1. جدول `calendar_events` ایجاد شده است
2. سرور در حال اجرا است
3. API endpoint `/api/calendar-events` کار می‌کند

### مشکل: خطای Foreign Key

**راه‌حل**: مطمئن شوید که:

1. جدول `users` وجود دارد
2. ستون `user_id` در جدول `users` از نوع `varchar(255)` است
3. SQL با موفقیت اجرا شده است

### مشکل: تقویم بارگذاری نمی‌شود

**راه‌حل**:

1. کنسول مرورگر را بررسی کنید
2. مطمئن شوید که FullCalendar بارگذاری شده است
3. اتصال اینترنت را بررسی کنید

### مشکل: تاریخ‌ها درست نمایش داده نمی‌شوند

**راه‌حل**:

1. مطمئن شوید که تقویم با locale انگلیسی تنظیم شده است
2. تاریخ‌ها در فرم باید به صورت YYYY-MM-DD باشند
3. کنسول مرورگر را برای خطاهای تاریخ بررسی کنید

## 📝 نکات مهم

1. **فقط رویدادهای سفارشی قابل ویرایش/حذف هستند**
2. **رویدادهای سیستم (تعطیلات، مرخصی‌ها و...) فقط قابل مشاهده هستند**
3. **هر کاربر فقط رویدادهای خودش را می‌بیند**
4. **تغییرات بلافاصله در دیتابیس ذخیره می‌شوند**
5. **تاریخ‌ها در دیتابیس به صورت میلادی ذخیره می‌شوند**

## 🎉 نتیجه

حالا شما یک تقویم زیبا، کاربردی و کاملاً یکپارچه با سیستم حضور و غیاب دارید که:

- ✅ رویدادها را در دیتابیس ذخیره می‌کند
- ✅ پس از رفرش باقی می‌مانند
- ✅ طراحی یکپارچه با قالب سیستم دارد
- ✅ عملکرد سریع و روان دارد
- ✅ با سیستم موجود هماهنگ است
- ✅ مدیریت صحیح تاریخ‌ها دارد

**🎯 تقویم شما آماده استفاده است!**
